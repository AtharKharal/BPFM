---
# title: "Data Cleaning"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(reticulate)
```

# Reading Data  
All the values marked as '?' have been read-in as NA's using built-in feature of pandas read_csv method.  
```{python}
import pandas as pd
df_original = pd.read_csv('Blood_Pressure_data.csv', na_values='?',  )
```
## Type Conversions  

```{python}
df_original.dtypes
```
```{python, evaluate=FALSE}
to_convert = ['cast','gender','age group','diag_1','diag_2','diag_3','max_glu_serum','A1Cresult', 'glimepiride',
       'pioglitazone', 'rosiglitazone', 'insulin', 'glyburide-metformin',
       'change', 'Med', 'label']
# df[to_convert] = df_original[to_convert].astype('category')
# df.dtypes
```

## Data Summaries  

We first examine the percentage of missing values in each column as follows: 
```{python}
df=df_original
percent_missing = round(df.isnull().sum() * 100 / len(df),2)
missing_value_df = pd.DataFrame({'Variable': df.columns,
                                 'MissingPercent': percent_missing})
missing_value_df.sort_values('MissingPercent', inplace=True, ascending=False)
missing_value_df[missing_value_df.MissingPercent>0]
```
New consider the number of unique values in each variable, specially in categorical variables:  
```{python}
df.nunique()
```
## Data Cleaning  

Combining the information present in Missing Values and Number of distinct values we determine certain cleaning tasks and also apply a transformation on label variable. Details of these cleaning steps are as follows:  

- Replace all "?" with NA (Not Available).  

- Factors '>5' and '<30' have been lumped together in new category named 'YES'.  
  
```{python}
# dt = pd.DataFrame({'a':[1,3,3,1], 'b':[2,2,4,5]})
label_dict = {'>5':'YES', '<30':'YES','NO':'NO'}
df = df.replace(dict(label=label_dict))
df.head(20)
```
**Variables to be Deleted:**  

- *id, weight, discharge_disposition_id, admission_source_id, patient_no and admission_typeid* are useless because of having more than 10 factors   

- *payer_code and medical_specialty* have very high number of factors 17 and 72, respectively.  Moreover they contain integer and alphanumeric factors simultaneously.  

- *examide* and *citoglipton* have only 1 factor throughout i.e. have 0 variance  

- *repaglinide, nateglinide, chlorpropamide, acetohexamide, tolbutamide, acarbose, miglitol, troglitazone, tolazamide, glyburide, glipizide, glimepiride-pioglitazone, metformin, metformin-pioglitazone, metformin-rosiglitazone, glipizide-metformin* have abnormal factor counts, which may also be visualized through graphs on the Visualization page of this website. 


```{python}
cols_to_delete = ['id', 'weight', 'discharge_disposition_id', 'admission_source_id', 'patient_no', 'admission_typeid','payer_code', 'medical_specialty', 'examide', 'citoglipton', 'repaglinide', 'nateglinide', 'chlorpropamide', 'acetohexamide', 'tolbutamide', 'acarbose', 'miglitol', 'troglitazone', 'tolazamide', 'glyburide', 'glipizide', 'glimepiride-pioglitazone', 'metformin', 'metformin-pioglitazone', 'metformin-rosiglitazone', 'glipizide-metformin','diag_1', 'diag_2', 'diag_3']

df = df_original.drop(cols_to_delete, axis=1, inplace=False)

df.columns

```

```{python}
print(df.info())
```


# Auto Profile of Data  

```{python}
# from pandas_profiling import ProfileReport
# 
# #EDA using pandas-profiling
# profile = ProfileReport(df, explorative=True)

#Saving results to a HTML file
# profile.to_file("BP_data_profile.html")
```





